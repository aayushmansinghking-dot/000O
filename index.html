<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JP Residency - Futuristic Management</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-blue: #00f2ff;
            --neon-purple: #bc13fe;
            --dark-bg: #0a0b10;
            --glass: rgba(255, 255, 255, 0.05);
            --border: rgba(0, 242, 255, 0.3);
        }

        body {
            background: radial-gradient(circle at center, #1b2735 0%, #090a0f 100%);
            color: #e0e0e0;
            font-family: 'Rajdhani', sans-serif;
            margin: 0; padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: auto;
            background: var(--glass);
            backdrop-filter: blur(15px);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 0 30px rgba(0, 242, 255, 0.1);
        }

        h1, h2, h3 {
            font-family: 'Orbitron', sans-serif;
            color: var(--neon-blue);
            text-shadow: 0 0 10px rgba(0, 242, 255, 0.5);
            text-align: center;
        }

        .card {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
        }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }

        input, select, textarea {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            color: white;
            padding: 12px;
            border-radius: 5px;
            width: 100%;
            box-sizing: border-box;
        }

        button {
            background: transparent;
            color: var(--neon-blue);
            border: 1px solid var(--neon-blue);
            padding: 12px;
            font-family: 'Orbitron', sans-serif;
            cursor: pointer;
            transition: 0.3s;
            width: 100%;
            margin-top: 10px;
            border-radius: 5px;
        }

        button:hover {
            background: var(--neon-blue);
            color: #000;
            box-shadow: 0 0 15px var(--neon-blue);
        }

        .img-preview {
            width: 100%;
            max-width: 300px;
            border: 2px dashed var(--border);
            margin-top: 10px;
            border-radius: 10px;
        }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { color: var(--neon-purple); border-bottom: 2px solid var(--border); padding: 10px; text-align: left; }
        td { padding: 10px; border-bottom: 1px solid rgba(255, 255, 255, 0.05); }

        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>JP RESIDENCY</h1>
        <div id="homePage">
            <button onclick="showSection('regForm')">New Registration</button>
            <button onclick="showSection('userLogin')">Already Registered</button>
            <button onclick="showSection('ownerLogin')">Owner Login</button>
        </div>
              <div id="regForm" class="hidden">
            <h2>Guest Registration</h2>
            <div class="grid">
                <input type="text" id="regFullName" placeholder="Full Name">
                <select id="regGender">
                    <option value="">Select Gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                </select>
                <input type="number" id="regMobile" placeholder="Mobile Number">
                <input type="email" id="regEmail" placeholder="Email ID">
            </div>
            <textarea id="regAddress" placeholder="Full Address" rows="2" style="margin-top:15px;"></textarea>
            
            <h3>ID Proof & Room Details</h3>
            <div class="grid">
                <select id="idType">
                    <option value="Aadhaar">Aadhaar</option>
                    <option value="PAN">PAN</option>
                    <option value="Passport">Passport</option>
                </select>
                <input type="text" id="idNum" placeholder="ID Number">
                <input type="date" id="liveDate">
                <input type="number" id="guestCount" placeholder="Number of Guests">
            </div>

            <div class="grid">
                <input type="number" id="regRent" placeholder="Monthly Rent (₹)">
                <input type="number" id="regAdvance" placeholder="Advance Paid (₹)">
                <input type="number" id="regPrevMeter" placeholder="Previous Meter Reading">
            </div>

            <h3>Upload Documents</h3>
            <label>ID Image:</label> <input type="file" id="upId" onchange="preview(this, 'p1')">
            <label>Signature:</label> <input type="file" id="upSig" onchange="preview(this, 'p2')">
            <label>Meter Photo:</label> <input type="file" id="upMeter" onchange="preview(this, 'p3')">
            
            <h3>Set Password</h3>
            <input type="password" id="regPass" placeholder="4-digit Password">
            
            <button onclick="registerUser()">Submit Registration</button>
            <button onclick="showSection('homePage')">Back</button>
        </div>

        <div id="userLogin" class="hidden">
            <h2>Resident Login</h2>
            <input type="text" id="loginID" placeholder="Registration Number">
            <input type="password" id="loginPass" placeholder="Password">
            <button onclick="handleUserLogin()">Login</button>
            <button onclick="showSection('homePage')">Back</button>
        </div>

        <div id="ownerLogin" class="hidden">
            <h2>Owner Access</h2>
            <input type="password" id="ownerPass" placeholder="Owner Password">
            <button onclick="handleOwnerLogin()">Access Terminal</button>
            <button onclick="showSection('homePage')">Back</button>
        </div>
              <div id="dashboard" class="hidden">
            <h2 id="dashTitle">Resident Profile</h2>
            
            <div class="card">
                <h3>Monthly Payments</h3>
                <table>
                    <thead><tr><th>Month</th><th>Rent</th><th>Status</th></tr></thead>
                    <tbody id="paymentBody"></tbody>
                </table>
            </div>

            <div class="card">
                <h3>Electric Bill Calculator</h3>
                <div class="grid">
                    <input type="number" id="calcPrev" placeholder="Previous Reading">
                    <input type="number" id="calcPres" placeholder="Present Reading">
                    <input type="number" id="calcUnit" placeholder="Rate Per Unit">
                </div>
                <button onclick="calculateBill()">Calculate & Save</button>
                <h4 id="calcResult" style="text-align:center;">Total: ₹0</h4>
                
                <h4>Electric Bill Records</h4>
                <table id="elecTable">
                    <thead><tr><th>Date</th><th>Units</th><th>Total</th></tr></thead>
                    <tbody id="elecBody"></tbody>
                </table>
            </div>

            <div class="card">
                <h3>Document Verification</h3>
                <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">
                    <div><p>ID Proof</p><img id="viewId" class="img-preview"></div>
                    <div><p>Signature</p><img id="viewSig" class="img-preview"></div>
                    <div><p>Meter</p><img id="viewMet" class="img-preview"></div>
                </div>
            </div>

            <div id="ownerPanel" class="hidden">
                <div class="card" style="border: 1px solid var(--neon-purple);">
                    <h3>Admin Controls</h3>
                    <input type="text" id="payMonth" placeholder="Month">
                    <input type="number" id="payAmt" placeholder="Amount">
                    <select id="payStatus">
                        <option value="Paid">Paid</option>
                        <option value="Pending">Pending</option>
                    </select>
                    <button onclick="savePayment()">Update Payment for this User</button>
                </div>
            </div>

            <button onclick="showSection('homePage')">Logout</button>
              </div>
      <script>
    let currentUserID = null;
    let images = { id: "", sig: "", met: "" };

    function showSection(id) {
        document.querySelectorAll('.container > div').forEach(d => d.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

    function preview(input, key) {
        const reader = new FileReader();
        reader.onload = (e) => { images[key] = e.target.result; };
        reader.readAsDataURL(input.files[0]);
    }

    function registerUser() {
        const id = "JP" + Math.floor(1000 + Math.random() * 9000);
        const data = {
            id: id,
            name: document.getElementById('regFullName').value,
            pass: document.getElementById('regPass').value,
            rent: document.getElementById('regRent').value,
            imgId: images.p1,
            imgSig: images.p2,
            imgMet: images.p3
        };
        localStorage.setItem(id, JSON.stringify(data));
        alert("Success! ID: " + id);
        showSection('homePage');
    }

    function handleUserLogin() {
        const id = document.getElementById('loginID').value;
        const pass = document.getElementById('loginPass').value;
        const user = JSON.parse(localStorage.getItem(id));
        if(user && user.pass === pass) {
            currentUserID = id;
            loadPortal(id, false);
        } else alert("Error");
    }

    function handleOwnerLogin() {
        if(document.getElementById('ownerPass').value === "owner123") {
            const id = prompt("Enter Resident ID to manage:");
            if(localStorage.getItem(id)) {
                currentUserID = id;
                loadPortal(id, true);
            } else alert("Not found");
        }
    }

    function loadPortal(id, isAdmin) {
        const user = JSON.parse(localStorage.getItem(id));
        document.getElementById('dashTitle').innerText = "Portal: " + user.name;
        document.getElementById('viewId').src = user.imgId || '';
        document.getElementById('viewSig').src = user.imgSig || '';
        document.getElementById('viewMet').src = user.imgMet || '';
        
        isAdmin ? document.getElementById('ownerPanel').classList.remove('hidden') 
                : document.getElementById('ownerPanel').classList.add('hidden');

        refreshTables();
        showSection('dashboard');
    }

    function refreshTables() {
        // IMPORTANT: Unique keys per user ID
        const payKey = "pay_" + currentUserID;
        const elecKey = "elec_" + currentUserID;

        const payments = JSON.parse(localStorage.getItem(payKey)) || [];
        const elec = JSON.parse(localStorage.getItem(elecKey)) || [];

        document.getElementById('paymentBody').innerHTML = payments.map(p => 
            `<tr><td>${p.m}</td><td>₹${p.a}</td><td>${p.s}</td></tr>`).join('');

        document.getElementById('elecBody').innerHTML = elec.map(e => 
            `<tr><td>${e.d}</td><td>${e.u}</td><td>₹${e.t}</td></tr>`).join('');
    }

    function savePayment() {
        const payKey = "pay_" + currentUserID;
        let data = JSON.parse(localStorage.getItem(payKey)) || [];
        data.push({
            m: document.getElementById('payMonth').value,
            a: document.getElementById('payAmt').value,
            s: document.getElementById('payStatus').value
        });
        localStorage.setItem(payKey, JSON.stringify(data));
        refreshTables();
    }

    function calculateBill() {
        const pre = document.getElementById('calcPrev').value;
        const pres = document.getElementById('calcPres').value;
        const rate = document.getElementById('calcUnit').value;
        const units = pres - pre;
        const total = units * rate;
        document.getElementById('calcResult').innerText = "Total: ₹" + total;

        const elecKey = "elec_" + currentUserID;
        let data = JSON.parse(localStorage.getItem(elecKey)) || [];
        data.push({ d: new Date().toLocaleDateString(), u: units, t: total });
        localStorage.setItem(elecKey, JSON.stringify(data));
        refreshTables();
    }
</script>
</body>
</html>

